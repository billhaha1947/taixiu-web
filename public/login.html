<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÄÄƒng nháº­p | TÃ i Xá»‰u Vui Váº»</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ² TÃ i Xá»‰u Vui Váº»</h1>
    <h3 id="formTitle">ÄÄƒng nháº­p</h3>

    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Máº­t kháº©u" />
    <input id="username" placeholder="TÃªn hiá»ƒn thá»‹" style="display:none" />

    <button id="authBtn">ÄÄƒng nháº­p</button>

    <p id="toggleForm">
      ChÆ°a cÃ³ tÃ i khoáº£n? <a href="#" id="switchToRegister">ÄÄƒng kÃ½</a>
    </p>

    <p id="message" style="margin-top: 10px; color: yellow;"></p>
  </div>

  <script type="module">
    import { register, login, auth, db, getUserData } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const emailEl = document.getElementById("email");
    const passwordEl = document.getElementById("password");
    const usernameEl = document.getElementById("username");
    const authBtn = document.getElementById("authBtn");
    const messageEl = document.getElementById("message");
    const formTitle = document.getElementById("formTitle");

    let mode = "login"; // login / register

    document.getElementById("switchToRegister").onclick = (e) => {
      e.preventDefault();
      if (mode === "login") {
        mode = "register";
        formTitle.textContent = "ÄÄƒng kÃ½ tÃ i khoáº£n";
        usernameEl.style.display = "block";
        authBtn.textContent = "ÄÄƒng kÃ½";
        e.target.textContent = "ÄÄƒng nháº­p";
      } else {
        mode = "login";
        formTitle.textContent = "ÄÄƒng nháº­p";
        usernameEl.style.display = "none";
        authBtn.textContent = "ÄÄƒng nháº­p";
        e.target.textContent = "ÄÄƒng kÃ½";
      }
    };

    authBtn.onclick = async () => {
      const email = emailEl.value.trim();
      const pass = passwordEl.value.trim();
      const name = usernameEl.value.trim();

      try {
        if (mode === "login") {
          await login(email, pass);
          messageEl.textContent = "ÄÄƒng nháº­p thÃ nh cÃ´ng!";
        } else {
          await register(email, pass, name);
          messageEl.textContent = "ÄÄƒng kÃ½ thÃ nh cÃ´ng!";
        }
      } catch (err) {
        messageEl.textContent = err.message;
      }
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const info = await getUserData(user.uid);
        if (!info) return;
        if (info.role === "admin") window.location.href = "/admin.html";
        else window.location.href = "/index.html";
      }
    });
  </script>
</body>
</html>
